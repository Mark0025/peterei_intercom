# Next.js Migration - GitHub Issues

## Phase 1: Core Infrastructure (Foundation)

### Issue 1: Setup Strict TypeScript Configuration
**Labels:** `migration`, `typescript`, `enhancement`
**Priority:** High

**Description:**
Configure strict TypeScript settings as per migration plan.

**Tasks:**
- [ ] Set `strict: true` in tsconfig.json
- [ ] Add `noUncheckedIndexedAccess: true`
- [ ] Add `exactOptionalPropertyTypes: true`
- [ ] Add `noImplicitReturns: true`
- [ ] Add `noFallthroughCasesInSwitch: true`
- [ ] Fix all type errors from strict mode
- [ ] Verify build passes

**Acceptance Criteria:**
- TypeScript build passes with strict mode
- No type errors or warnings

---

### Issue 2: Centralize Type Definitions
**Labels:** `migration`, `typescript`, `refactor`
**Priority:** High

**Description:**
Extract all types from Express app to centralized `/types` directory in Next.js app.

**Tasks:**
- [ ] Create comprehensive Intercom API types (`IntercomContact`, `IntercomCompany`, `IntercomAdmin`, `IntercomConversation`)
- [ ] Create Canvas Kit types (`CanvasComponent`, `CanvasResponse`, etc.)
- [ ] Create onboarding types (`OnboardingSection`, `Question`, `OnboardingData`)
- [ ] Create PeteAI types
- [ ] Update all imports to use `@/types`
- [ ] Remove duplicate type definitions

**Acceptance Criteria:**
- All types in `/types` directory
- No duplicate type definitions
- All imports use path aliases

---

## Phase 2: Server Actions Migration

### Issue 3: Complete Canvas Kit Server Actions
**Labels:** `migration`, `server-actions`, `canvas-kit`
**Priority:** High

**Description:**
Migrate all Canvas Kit endpoints from Express to Next.js server actions.

**Express Routes to Migrate:**
- `POST /initialize` → `src/actions/canvas-kit.ts::initializeCanvas()`
- `POST /submit` → `src/actions/canvas-kit.ts::submitCanvas()`

**Tasks:**
- [ ] Verify signature validation in server actions
- [ ] Migrate all Canvas Kit component builders
- [ ] Add comprehensive error handling
- [ ] Add logging for all actions
- [ ] Test with Intercom Messenger
- [ ] Test with Intercom Inbox

**Acceptance Criteria:**
- All Canvas Kit flows work identically to Express app
- Signature validation works
- Errors handled gracefully

---

### Issue 4: Complete Onboarding Server Actions
**Labels:** `migration`, `server-actions`, `onboarding`
**Priority:** High

**Description:**
Migrate onboarding flow from Express to Next.js server actions.

**Express Routes to Migrate:**
- `POST /popout-submit` → `src/actions/onboarding.ts::submitOnboarding()`
- Questionnaire processing logic

**Tasks:**
- [ ] Migrate 7-level questionnaire system
- [ ] Migrate onboarding_questions.json parsing
- [ ] Add server action for form submission
- [ ] Integrate with Intercom API for data storage
- [ ] Test full onboarding flow
- [ ] Verify data persistence

**Acceptance Criteria:**
- Full questionnaire works in Next.js
- Data saved to Intercom correctly
- Popout form functional

---

### Issue 5: Complete Intercom API Server Actions
**Labels:** `migration`, `server-actions`, `intercom-api`
**Priority:** High

**Description:**
Migrate all Intercom API mutations from Express routes to server actions.

**Express Routes to Migrate:**
- `PUT /contacts/:id/training-topic` → `src/actions/intercom.ts::updateContactTrainingTopic()`
- `POST /bulk-update-training-topic` → `src/actions/intercom.ts::bulkUpdateTrainingTopic()`
- Other Intercom mutations

**Tasks:**
- [ ] Migrate contact update actions
- [ ] Migrate company update actions
- [ ] Migrate bulk operations
- [ ] Add GET validation before PUT/POST (per Cursor rules)
- [ ] Add comprehensive logging
- [ ] Add error handling with retry logic

**Acceptance Criteria:**
- All Intercom mutations work via server actions
- GET validation enforced before updates
- Errors handled gracefully

---

## Phase 3: Convert Bash Scripts to TypeScript

### Issue 6: Migrate Admin Bash Scripts to Server Actions
**Labels:** `migration`, `admin`, `bash-to-typescript`
**Priority:** Medium

**Description:**
Convert all bash scripts in `intercomApp/src/scripts/` to TypeScript server actions in `app/(admin)/actions/`.

**Scripts to Migrate:**
- [ ] `update_company_petetraining.sh` → `updateCompanyTraining()`
- [ ] `get_admin_by_id.sh` → `getAdminById()`
- [ ] `endpoint_health_check.sh` → `checkEndpointHealth()`
- [ ] `get_me.sh` → `getMe()`
- [ ] `get_company_id_by_name.sh` → `getCompanyIdByName()`
- [ ] `create_pete_user_training_topic.sh` → `createUserTrainingTopic()`
- [ ] `get_pete_user_training_topic.sh` → `getUserTrainingTopic()`
- [ ] `get_contact_id_by_email.sh` → `getContactIdByEmail()`
- [ ] `get_all_pete_user_training_topics.sh` → `getAllTrainingTopics()`
- [ ] `update_user_training_topic.sh` → `updateUserTrainingTopic()`
- [ ] `get_admins.sh` → `getAdmins()`

**Tasks:**
- [ ] Create `app/(admin)/actions/` directory
- [ ] Convert each bash script to TypeScript function
- [ ] Add proper typing for all functions
- [ ] Add error handling
- [ ] Add logging
- [ ] Create admin UI to trigger these actions
- [ ] Test each action thoroughly

**Acceptance Criteria:**
- All bash scripts converted to TypeScript
- Admin UI can trigger all actions
- All actions work correctly
- No bash scripts remain in use

---

## Phase 4: API Routes & Webhooks

### Issue 7: Complete Webhook API Routes
**Labels:** `migration`, `api-routes`, `webhooks`
**Priority:** High

**Description:**
Ensure all webhook endpoints are properly migrated and tested.

**Express Routes to Verify/Migrate:**
- `POST /webhooks` → `app/api/webhooks/route.ts`
- Intercom webhook signature validation
- Webhook event processing

**Tasks:**
- [ ] Verify webhook signature validation
- [ ] Test all Intercom webhook events
- [ ] Add comprehensive logging
- [ ] Add error handling
- [ ] Document webhook setup

**Acceptance Criteria:**
- Webhooks receive Intercom events correctly
- Signature validation works
- Events processed correctly

---

### Issue 8: Complete Intercom Proxy API Routes
**Labels:** `migration`, `api-routes`, `intercom-api`
**Priority:** Medium

**Description:**
Migrate Intercom API proxy routes from Express.

**Express Routes to Migrate:**
- `GET /api/intercom/*` → `app/api/intercom/[...slug]/route.ts`

**Tasks:**
- [ ] Verify all proxy routes work
- [ ] Add caching where appropriate
- [ ] Add rate limiting
- [ ] Add comprehensive logging
- [ ] Test all endpoints

**Acceptance Criteria:**
- All Intercom API calls proxied correctly
- Caching works
- Rate limiting enforced

---

## Phase 5: Admin Dashboard Completion

### Issue 9: Complete Admin Dashboard Pages
**Labels:** `migration`, `admin`, `ui`
**Priority:** Medium

**Description:**
Ensure all admin pages from Express app are migrated to Next.js.

**Pages to Verify/Complete:**
- [ ] `/admin` - Dashboard home
- [ ] `/admin/logs` - Log viewer
- [ ] `/admin/peteai` - PeteAI interface
- [ ] `/admin/training` - Training management
- [ ] `/admin/support` - Support tools
- [ ] `/admin/testapi` - API testing
- [ ] `/admin/health` - Health checks

**Tasks:**
- [ ] Verify all admin routes exist
- [ ] Connect to server actions
- [ ] Add proper authentication/authorization
- [ ] Test all functionality
- [ ] Add loading states
- [ ] Add error handling

**Acceptance Criteria:**
- All admin pages functional
- Connected to server actions
- Authentication working
- UI matches Express app functionality

---

## Phase 6: PeteAI Migration

### Issue 10: Complete PeteAI Integration
**Labels:** `migration`, `peteai`, `ai`
**Priority:** Medium

**Description:**
Ensure PeteAI functionality is fully migrated from Express.

**Express Routes to Verify:**
- `POST /PeteAI/` → `app/api/PeteAI/route.ts`
- LangGraph agent integration

**Tasks:**
- [ ] Verify PeteAI API route works
- [ ] Test LangGraph agent
- [ ] Verify OpenRouter integration
- [ ] Add comprehensive logging
- [ ] Test chat interface
- [ ] Add error handling

**Acceptance Criteria:**
- PeteAI chat works correctly
- LangGraph agent functional
- Responses logged properly

---

## Phase 7: Testing & Validation

### Issue 11: Comprehensive Testing of Migrated Features
**Labels:** `migration`, `testing`, `quality-assurance`
**Priority:** High

**Description:**
Thoroughly test all migrated features to ensure parity with Express app.

**Testing Checklist:**
- [ ] Canvas Kit flows (Messenger & Inbox)
- [ ] Onboarding questionnaire
- [ ] All admin pages
- [ ] All server actions
- [ ] Intercom API integration
- [ ] PeteAI functionality
- [ ] Webhook processing
- [ ] Health checks
- [ ] Logging system
- [ ] Caching system
- [ ] Error handling

**Tasks:**
- [ ] Create test plan document
- [ ] Manual testing of all features
- [ ] Document any bugs found
- [ ] Fix all critical bugs
- [ ] Verify performance
- [ ] Check logs for errors

**Acceptance Criteria:**
- All features work identically to Express app
- No critical bugs
- Performance acceptable
- Logs clean

---

## Phase 8: Code Cleanup & Documentation

### Issue 12: ESLint Configuration & Code Quality
**Labels:** `migration`, `code-quality`, `linting`
**Priority:** Medium

**Description:**
Set up ESLint rules and enforce code quality standards.

**Tasks:**
- [ ] Add custom ESLint rules:
  - `no-duplicate-types` - Fails on types outside `/types`
  - `prefer-server-actions` - Warns on client fetch to own API
  - `import/no-relative-parent-imports` - Forces `@/types` alias
- [ ] Run linter on entire codebase
- [ ] Fix all linting errors
- [ ] Add pre-commit hooks

**Acceptance Criteria:**
- All ESLint rules passing
- No linting errors
- Pre-commit hooks working

---

### Issue 13: Update Documentation
**Labels:** `migration`, `documentation`
**Priority:** Medium

**Description:**
Update all documentation to reflect Next.js architecture.

**Tasks:**
- [ ] Update README.md with Next.js instructions
- [ ] Update CLAUDE.md (already done)
- [ ] Document all server actions
- [ ] Document all API routes
- [ ] Create migration completion report
- [ ] Update DEV_MAN documentation
- [ ] Document new development workflow

**Acceptance Criteria:**
- All docs updated and accurate
- README reflects Next.js app
- Migration report complete

---

## Phase 9: Final Migration & Cleanup

### Issue 14: Delete Express App (FINAL STEP)
**Labels:** `migration`, `cleanup`, `breaking-change`
**Priority:** Critical

**Description:**
⚠️ **ONLY AFTER ALL ABOVE ISSUES ARE COMPLETE** ⚠️

Delete the entire Express app and make Next.js app the only application.

**Pre-deletion Checklist:**
- [ ] All features migrated and tested
- [ ] All bash scripts converted
- [ ] All admin functions working
- [ ] Production deployment tested
- [ ] Backup created
- [ ] Team notified

**Tasks:**
- [ ] Create backup branch with Express app
- [ ] Delete `intercomApp/` directory entirely
- [ ] Move `pete-intercom-nextjs/` to root (or rename)
- [ ] Update `start.sh` to run Next.js
- [ ] Update all environment variable documentation
- [ ] Update deployment scripts
- [ ] Test production deployment
- [ ] Monitor for 24 hours

**Files/Directories to Delete:**
```
intercomApp/src/
intercomApp/package.json
intercomApp/README.md
```

**Acceptance Criteria:**
- Express app completely removed
- Next.js app is only application
- Production deployment successful
- No functionality lost
- All tests passing

---

## Migration Metrics

**Total Issues:** 14
**Priority Breakdown:**
- Critical: 1
- High: 6
- Medium: 7

**Estimated Timeline:**
- Phase 1-2: 1-2 weeks
- Phase 3-4: 2-3 weeks
- Phase 5-6: 1-2 weeks
- Phase 7-9: 1-2 weeks
**Total: 5-9 weeks**

---

## Notes

1. **Order Matters:** Issues should be completed in order (Phase 1 → Phase 9)
2. **Testing After Each Phase:** Run comprehensive tests after completing each phase
3. **No Deletions Until Issue 14:** Do NOT delete Express code until Issue 14
4. **Backup Strategy:** Create git tags at each phase completion
5. **Rollback Plan:** Keep Express app functional until final deletion